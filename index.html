<!-- ...o resto do código permanece igual... -->

<aside id="cart" aria-label="Carrinho de compras">
  <h2>Seu Carrinho</h2>
  <ul id="cartItems"></ul>
  <div class="total">Total: R$ <span id="cartTotal">0,00</span></div>

  <div id="pedidoResumo" style="margin-top:1rem; background:#164216; padding:10px; border-radius:8px; color:#b5e48c; font-size:0.9rem; white-space: pre-wrap; user-select: all;">
    <strong>Resumo do pedido aparecerá aqui...</strong>
  </div>

  <div id="pixPayment" style="display:none; margin-top:1rem;">
    <p>Pague via Pix com o QR Code:</p>
    <img id="pixQR" src="" alt="QR Code Pix" title="Clique para copiar chave Pix" />
    <div class="pixKey" id="pixKey" title="Clique para copiar chave Pix" tabindex="0"></div>
    <a id="whatsappLink" href="#" target="_blank" rel="noopener noreferrer" aria-label="Enviar comprovante pelo WhatsApp">Enviar WhatsApp</a>
  </div>

  <button id="closeCart">Fechar Carrinho</button>
</aside>

<script>
  const pixKey = 'israeldasilvasantos355@gmail.com';

  const openCartBtn = document.getElementById('openCartBtn');
  const cart = document.getElementById('cart');
  const cartItemsEl = document.getElementById('cartItems');
  const cartTotalEl = document.getElementById('cartTotal');
  const pixPayment = document.getElementById('pixPayment');
  const pixQR = document.getElementById('pixQR');
  const pixKeyEl = document.getElementById('pixKey');
  const whatsappLink = document.getElementById('whatsappLink');
  const closeCartBtn = document.getElementById('closeCart');
  const pedidoResumoEl = document.getElementById('pedidoResumo');

  // Armazena os itens com quantidade e detalhes
  let cartItems = [];

  openCartBtn.addEventListener('click', () => {
    cart.classList.add('open');
    updateCart();
  });
  closeCartBtn.addEventListener('click', () => {
    cart.classList.remove('open');
  });

  pixKeyEl.textContent = pixKey;
  pixKeyEl.addEventListener('click', () => {
    navigator.clipboard.writeText(pixKey).then(() => {
      alert('Chave Pix copiada!');
    });
  });
  pixKeyEl.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      navigator.clipboard.writeText(pixKey).then(() => {
        alert('Chave Pix copiada!');
      });
    }
  });

  function addToCart(name, price, details) {
    // Se já tiver, só aumenta a quantidade
    const existing = cartItems.find(item => item.name === name);
    if (existing) {
      existing.quantity++;
    } else {
      cartItems.push({name, price, details, quantity: 1});
    }
    alert(`${name} adicionado ao carrinho!`);
    openCartBtn.click();
    updateCart();
  }

  function removeFromCart(name) {
    cartItems = cartItems.filter(item => item.name !== name);
    updateCart();
  }

  function changeQuantity(name, quantity) {
    if (quantity < 1) return;
    const item = cartItems.find(i => i.name === name);
    if (item) {
      item.quantity = quantity;
      updateCart();
    }
  }

  function updateCart() {
    cartItemsEl.innerHTML = '';
    if(cartItems.length === 0){
      cartItemsEl.innerHTML = '<li>Seu carrinho está vazio.</li>';
      pixPayment.style.display = 'none';
      cartTotalEl.textContent = '0,00';
      pedidoResumoEl.textContent = 'Resumo do pedido aparecerá aqui...';
      whatsappLink.href = '#';
      return;
    }

    let total = 0;
    cartItems.forEach(item => {
      const subTotal = item.price * item.quantity;
      total += subTotal;

      const li = document.createElement('li');
      li.innerHTML = `
        <span><strong>${item.name}</strong> - R$ ${item.price.toFixed(2)} x 
        <input type="number" min="1" value="${item.quantity}" style="width:45px; margin-left:5px; border-radius:4px; border:none; text-align:center;" aria-label="Quantidade de ${item.name}" />
        = R$ ${subTotal.toFixed(2)}</span>
        <button class="remove" aria-label="Remover ${item.name} do carrinho">X</button>
      `;

      const inputQty = li.querySelector('input[type=number]');
      inputQty.addEventListener('change', e => {
        const val = parseInt(e.target.value);
        if (isNaN(val) || val < 1) {
          e.target.value = item.quantity;
          return;
        }
        changeQuantity(item.name, val);
      });

      li.querySelector('button').addEventListener('click', () => {
        removeFromCart(item.name);
      });

      cartItemsEl.appendChild(li);
    });

    cartTotalEl.textContent = total.toFixed(2);

    // Mostrar Pix e gerar QRCode
    pixPayment.style.display = 'block';

    // Gerar pedido texto formatado para enviar
    let pedidoTexto = '🛒 *Resumo do Pedido* 🛒\n\n';
    cartItems.forEach(item => {
      pedidoTexto += `- ${item.name} (x${item.quantity}): R$ ${(item.price * item.quantity).toFixed(2)}\n`;
    });
    pedidoTexto += `\n*Total:* R$ ${total.toFixed(2)}\n\n`;
    pedidoTexto += `*Chave Pix:* ${pixKey}\n\nPor favor, envie o comprovante para que possamos liberar seu pedido.`;

    pedidoResumoEl.textContent = pedidoTexto;

    // QR Code Pix automático (usando API pública gratuita para gerar QR)
    const encodedPix = encodeURIComponent(`00020126580014br.gov.bcb.pix0136${pixKey}0208Compra Israel Store520400005303986540${(total*100).toFixed(0).padStart(10,'0')}5802BR5925Israel Store Loja6009Porto Alegre61080540900062070503***6304`);
    // Mas isso é só um exemplo, o ideal é gerar QR correto via API Pix real. Aqui só para demo:
    pixQR.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodedPix}`;

    // Link WhatsApp com pedido já formatado
    const whatsappNumber = '5551997097814'; // Seu número com código do país e DDD
    whatsappLink.href = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(pedidoTexto)}`;
  }
</script>